{
	"name": "SQL script 1",
	"properties": {
		"content": {
			"query": "IF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'SynapseParquetFormat') \n\tCREATE EXTERNAL FILE FORMAT [SynapseParquetFormat] \n\tWITH ( FORMAT_TYPE = PARQUET)\nGO\n\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'synapsedata01_dl4synapsesea01_dfs_core_windows_net') \n\tCREATE EXTERNAL DATA SOURCE [synapsedata01_dl4synapsesea01_dfs_core_windows_net] \n\tWITH (\n\t\tLOCATION = 'abfss://synapsedata01@dl4synapsesea01.dfs.core.windows.net'\n\t)\nGO\n\nCREATE EXTERNAL TABLE [dbo].[extt1] (\n\t[col1] int,\n\t[col2] datetime2\n\t)\n\tWITH (\n\tLOCATION = 'Parquet/dbo.extt1.parquet',\n\tDATA_SOURCE = [synapsedata01_dl4synapsesea01_dfs_core_windows_net],\n\tFILE_FORMAT = [SynapseParquetFormat]\n\t)\nGO\n\n\nSELECT TOP 100 * FROM [dbo].[extt1]\nGO\n\n\nCREATE EXTERNAL TABLE [dbo].[extt1_2] (\n\t[col1] int,\n\t[col2] datetime2\n\t)\n\tWITH (\n\tLOCATION = 'Parquet/dbo.extt1.parquet',\n\tDATA_SOURCE = [synapsedata01_dl4synapsesea01_dfs_core_windows_net],\n\tFILE_FORMAT = [SynapseParquetFormat],\n\tREJECT_VALUE = 500,\n\tREJECTED_ROW_LOCATION = 'Reject/'\n\t)\nGO\n\nSELECT TOP 100 * FROM [dbo].[extt1_2]\n\ndrop EXTERNAL TABLE dbo.extt1_3\n\nCREATE EXTERNAL TABLE [dbo].[extt1_3] (\n\t[col1] int,\n\t[col2] datetime2\n\t)\n\tWITH (\n\tLOCATION = 'Parquet/dbo.t1.parquet',\n\tDATA_SOURCE = [synapsedata01_dl4synapsesea01_dfs_core_windows_net],\n\tFILE_FORMAT = [SynapseParquetFormat],\n\tREJECT_VALUE = 500,\n\tREJECTED_ROW_LOCATION = 'Reject/'\n\t)\nGO\n\nSELECT * FROM [dbo].[extt1_3]\n\nhttps://savmdxivplakestg01.dfs.core.windows.net/data/raw/m_mysql_kna1/ivp_dt=20240702/data_630520b9-492f-4d86-8831-2caab945b651_4dc983bc-dee5-4b98-b6d2-2cfa038a43e6.parquet\n\n\n\nIF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'TestParquetFormat') \n\tCREATE EXTERNAL FILE FORMAT [TestParquetFormat] \n\tWITH ( FORMAT_TYPE = PARQUET)\nGO\n\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'TestDataSource') \n\tCREATE EXTERNAL DATA SOURCE [TestDataSource] \n\tWITH (\n\t\tLOCATION = 'abfss://data@savmdxivplakestg01.dfs.core.windows.net'\n\t)\nGO\n\nCREATE EXTERNAL TABLE [dbo].[extt1_2] (\n\t[col1] int,\n\t[col2] datetime2\n\t)\n\tWITH (\n\tLOCATION = 'raw/m_mysql_kna1/ivp_dt=20240702/data_630520b9-492f-4d86-8831-2caab945b651_4dc983bc-dee5-4b98-b6d2-2cfa038a43e6.parquet',\n\tDATA_SOURCE = [TestDataSource],\n\tFILE_FORMAT = [TestParquetFormat],\n\tREJECT_VALUE = 500,\n\tREJECTED_ROW_LOCATION = 'Reject/'\n\t)\nGO\n\n\n-- ---------------------------------------------------------------\n\ndrop EXTERNAL TABLE [dbo].[extt1_4]\n\nCREATE EXTERNAL TABLE [dbo].[extt1_4] (\n\t[zkzfustorcd] nvarchar(100),\n\t[zkzfssetkbn] nvarchar(100),\n\t[zkzdcbukrs] nvarchar(100),\n\t[zkzfdelotxt] nvarchar(100),\n\t[zkzfdelotxk] nvarchar(100),\n\t[zkzfdelotab] nvarchar(100),\n\t[zkzcusstdat] datetime2(7),\n\t[zkzcuseddat] datetime2(7),\n\t[zkzorotflg] nvarchar(100),\n\t[zkzorogrpcd] nvarchar(100),\n\t[zkzcmodeflg] nvarchar(100),\n\t[zkzemocoflg] nvarchar(100),\n\t[zkzppaidkbn] nvarchar(100),\n\t[zkzidcadkbn] nvarchar(100),\n\t[zkzondcpflg] nvarchar(100),\n\t[zkzppaemocd] nvarchar(100),\n\t[zkztranskbn] nvarchar(100),\n\t[zkztaxkbn] nvarchar(100),\n\t[zkzcprgrpcd] nvarchar(100),\n\t[zkzopcpgrcd] nvarchar(100),\n\t[zkzkemonkbn] nvarchar(100),\n\t[zkzfrpkbn] nvarchar(100),\n\t[zkzproekbn] nvarchar(100),\n\t[zkzpainukbn] nvarchar(100),\n\t[zkzimcedflg] nvarchar(100),\n\t[zkzarkunnr] nvarchar(100),\n\t[zkzppkunnr] nvarchar(100),\n\t[zkzidkunnr] nvarchar(100),\n\t[zkzcmonsflg] nvarchar(100),\n\t[zkzcmonscd] nvarchar(100),\n\t[zkzarpayee] nvarchar(100),\n\t[zkzarmgtkbn] nvarchar(100),\n\t[zkzmoparbuk] nvarchar(100),\n\t[zkzmopdebuk] nvarchar(100),\n\t[zkzmopucbuk] nvarchar(100),\n\t[zkzcoscbkbn] nvarchar(100),\n\t[zkzsplodgrcd] nvarchar(100),\n\t[zkzdiswerks] nvarchar(100),\n\t[zkzdirprocd] nvarchar(100),\n\t[zkzdibarocd] nvarchar(100),\n\t[zkzditeamcd] nvarchar(100),\n\t[zkzdirerocd] nvarchar(100),\n\t[zkzgrpcd] nvarchar(100),\n\t[zkzsmgtbuk] nvarchar(100),\n\t[zkzsmgtwer] nvarchar(100),\n\t[zkzsmgtrocd] nvarchar(100),\n\t[zkzmopsakbn] nvarchar(100),\n\t[zkzprsprt] nvarchar(100),\n\t[zkzcomcakbn] nvarchar(100),\n\t[zkzlacadttm] numeric(38,18),\n\t[zkzlcocakbn] nvarchar(100),\n\t[zkzlfsorkbn] nvarchar(100),\n\t[zkzsclrrflg] nvarchar(100),\n\t[zkzcmcorkbn] nvarchar(100),\n\t[zkzmbcorkbn] nvarchar(100),\n\t[zkzwinscd1] nvarchar(100),\n\t[zkzwinscd2] nvarchar(100),\n\t[zkzfvctkbn] nvarchar(100),\n\t[zkzfacecd] nvarchar(100),\n\t[zkzdecatkbn] nvarchar(100),\n\t[zkzdecapcd] nvarchar(100),\n\t[zkzdecalgo] nvarchar(100),\n\t[ZADMINDEL] nvarchar(100),\n\t[ZCOMMTYP] nvarchar(100),\n\t[ZAPCOMCC] nvarchar(100),\n\t[ZCOMCC] nvarchar(100),\n\t[ZSETSDATE] datetime2(7),\n\t[ZSETEDATE] datetime2(7),\n\t[ZUNIFRM] nvarchar(100),\n\t[zzernam] nvarchar(100),\n\t[zzersda] datetime2(7),\n\t[zzerzzt] datetime2(7),\n\t[zzaenam] nvarchar(100),\n\t[zzupdat] datetime2(7),\n\t[zzuptim] datetime2(7),\n\t[zzupind] nvarchar(100),\n\t[ZZLOEVM] nvarchar(100),\n\t[TIMESTAMP] datetime2(7),\n\t[ZKZONLINEFLG] nvarchar(100),\n\t[ZKZDPFLG] nvarchar(100),\n\t[ivp_dt] nvarchar(100)\n\t)\n\tWITH (\n\tLOCATION = 'Parquet/data_81fffbd5-cfb3-404e-90a2-fbfac31928cd_a54bdb6f-c3dc-448c-97fc-00100494f4f2.parquet',\n\tDATA_SOURCE = [synapsedata01_dl4synapsesea01_dfs_core_windows_net],\n\tFILE_FORMAT = [SynapseParquetFormat]\n\t)\nGO\n\nselect * from [dbo].[extt1_4]\n\n\nWITH \nraw_data AS (\n    SELECT *\n    FROM [dbo].[extt1_4] WHERE ivp_dt = 20240704\n),\nremoved_dup AS (\n    SELECT C.* \n    FROM (SELECT DISTINCT zkzfustorcd from raw_data) A\n    CROSS APPLY (SELECT TOP 1 * \n                FROM raw_data B\n                WHERE A.zkzfustorcd  = B.zkzfustorcd\n                ORDER by [TIMESTAMP] DESC) C\n),\nnew_data AS (\n    SELECT *\n        , CAST('2024-07-01 16:04:12' as date) as [ivp_created_date]\n        , CAST('2024-07-01 16:04:12' as datetime2) as [ivp_created_timestamp]\n        , 'CCBJI' as [ivp_created_co]\n        , 'IVP' as [ivp_created_by]\n        , 'IF' as [ivp_created_pgm_nm]\n        , CAST('2024-07-01 16:04:12' as date) as [ivp_updated_date]\n        , CAST('2024-07-01 16:04:12' as datetime2) as [ivp_updated_timestamp]\n        , 'CCBJI' as [ivp_updated_co]\n        , 'IVP' as [ivp_updated_by]\n        , 'IF' as [ivp_updated_pgm_nm]\n        , 'U' as [ivp_updated_cl]\n    FROM [removed_dup]\n),\nnew_data_set AS (\n    SELECT \n       new_data.[zkzfustorcd]\n      ,new_data.[zkzfssetkbn]\n      ,new_data.[zkzdcbukrs]\n      ,new_data.[zkzfdelotxt]\n      ,new_data.[zkzfdelotxk]\n      ,new_data.[zkzfdelotab]\n      ,new_data.[zkzcusstdat]\n      ,new_data.[zkzcuseddat]\n      ,new_data.[zkzorotflg]\n      ,new_data.[zkzorogrpcd]\n      ,new_data.[zkzcmodeflg]\n      ,new_data.[zkzemocoflg]\n      ,new_data.[zkzppaidkbn]\n      ,new_data.[zkzidcadkbn]\n      ,new_data.[zkzondcpflg]\n      ,new_data.[zkzppaemocd]\n      ,new_data.[zkztranskbn]\n      ,new_data.[zkztaxkbn]\n      ,new_data.[zkzcprgrpcd]\n      ,new_data.[zkzopcpgrcd]\n      ,new_data.[zkzkemonkbn]\n      ,new_data.[zkzfrpkbn]\n      ,new_data.[zkzproekbn]\n      ,new_data.[zkzpainukbn]\n      ,new_data.[zkzimcedflg]\n      ,new_data.[zkzarkunnr]\n      ,new_data.[zkzppkunnr]\n      ,new_data.[zkzidkunnr]\n      ,new_data.[zkzcmonsflg]\n      ,new_data.[zkzcmonscd]\n      ,new_data.[zkzarpayee]\n      ,new_data.[zkzarmgtkbn]\n      ,new_data.[zkzmoparbuk]\n      ,new_data.[zkzmopdebuk]\n      ,new_data.[zkzmopucbuk]\n      ,new_data.[zkzcoscbkbn]\n      ,new_data.[zkzsplodgrcd]\n      ,new_data.[zkzdiswerks]\n      ,new_data.[zkzdirprocd]\n      ,new_data.[zkzdibarocd]\n      ,new_data.[zkzditeamcd]\n      ,new_data.[zkzdirerocd]\n      ,new_data.[zkzgrpcd]\n      ,new_data.[zkzsmgtbuk]\n      ,new_data.[zkzsmgtwer]\n      ,new_data.[zkzsmgtrocd]\n      ,new_data.[zkzmopsakbn]\n      ,new_data.[zkzprsprt]\n      ,new_data.[zkzcomcakbn]\n      ,new_data.[zkzlacadttm]\n      ,new_data.[zkzlcocakbn]\n      ,new_data.[zkzlfsorkbn]\n      ,new_data.[zkzsclrrflg]\n      ,new_data.[zkzcmcorkbn]\n      ,new_data.[zkzmbcorkbn]\n      ,new_data.[zkzwinscd1]\n      ,new_data.[zkzwinscd2]\n      ,new_data.[zkzfvctkbn]\n      ,new_data.[zkzfacecd]\n      ,new_data.[zkzdecatkbn]\n      ,new_data.[zkzdecapcd]\n      ,new_data.[zkzdecalgo]\n      ,new_data.[ZADMINDEL]\n      ,new_data.[ZCOMMTYP]\n      ,new_data.[ZAPCOMCC]\n      ,new_data.[ZCOMCC]\n      ,new_data.[ZSETSDATE]\n      ,new_data.[ZSETEDATE]\n      ,new_data.[ZUNIFRM]\n      ,new_data.[ZKZONLINEFLG] as [zkzonlineflg]\n    ,new_data.[zkzonlinest]\n      ,new_data.[ZKZDPFLG] as [zkzdpflg]\n      ,new_data.[zzernam]\n      ,new_data.[zzersda]\n      ,new_data.[zzerzzt]\n      ,new_data.[zzaenam]\n      ,new_data.[zzupdat]\n      ,new_data.[zzuptim]\n      ,new_data.[zzupind]\n      ,new_data.[ZZLOEVM]\n      ,new_data.[TIMESTAMP]\n    ,new_data.[ivp_dt],\n       new_data.[ivp_updated_date],\n       new_data.[ivp_updated_timestamp],\n       new_data.[ivp_updated_co],\n       new_data.[ivp_updated_by],\n       new_data.[ivp_updated_pgm_nm],\n    FROM new_data\n)\nselect * from new_data_set;\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "db01",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}